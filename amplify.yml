version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        - node -e "console.log('NEXT_APP_EMAIL:', process.env.NEXT_APP_EMAIL)"
        - node -e "console.log('NEXT_APP_PWD:', process.env.NEXT_APP_PWD ? '[REDACTED]' : 'Not set')"
        - |
          if [ -n "$NEXT_APP_EMAIL" ] && [ -n "$NEXT_APP_PWD" ]; then
            echo "NEXT_APP_EMAIL=$NEXT_APP_EMAIL" >> .env.production
            echo "NEXT_APP_PWD=$NEXT_APP_PWD" >> .env.production
          else
            echo "Warning: NEXT_APP_EMAIL or NEXT_APP_PWD is not set"
          fi
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*